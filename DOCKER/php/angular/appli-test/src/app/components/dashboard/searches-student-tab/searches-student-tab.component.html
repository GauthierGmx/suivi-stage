<div class="content-box">
  @if (currentUserRole === 'STUDENT' && currentPageUrl === '/dashboard') {
    <div class="titleAndAddSearchButton">
      <h3><b>Recherches de stage</b></h3>
      <button
        (click)="goToAddSearchFormView()"
      >
        Ajouter une recherche
      </button>
    </div>
    <div class="searchBarAndfilters">
      <div class="search-container">
        <input 
          type="text"
          [(ngModel)]="searchTerm"
          (input)="onSearchTermChange($event)"
          placeholder="Rechercher sur un des champs..." 
          class="search-input"
        />
        @if (searchTerm) {
          <button 
            (click)="clearSearchTerm()"
            class="clear-button"
          >
            X
          </button>
        }
      </div>
  
      <div class="filter-buttons">
        <button 
          class="filter-button"
          [class]="currentDateFilter"
          (click)="toggleDateSort()"
        >
          Date
        </button>

        <select 
          #statutSelect
          [(ngModel)]="currentStatutFilter"
          (change)="setStatutFilter(currentStatutFilter, statutSelect)"
          class="filter-button"
        >
          <option value="all">Tous les statuts</option>
          <option value="En cours">En attente</option>
          <option value="Relancé">Relancé</option>
          <option value="Validé">Validé</option>
          <option value="Refusé">Refusé</option>
        </select>

        <select 
          #citySelect
          [(ngModel)]="currentCityFilter"
          (change)="setCityFilter(currentCityFilter, citySelect)"
          class="filter-button"
        >
          <option value="all">Toutes les villes</option>
          @for (city of availableCities; track city) {
            <option [value]="city">{{ city }}</option>
          }
        </select>
      </div>
    </div>
  
    <!-- Vue tableau pour desktop -->
    <div class="table-view">
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Entreprise</th>
              <th>Ville</th>
              <th>Date</th>
              <th>Statut</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            @for (item of filteredSearchesWithCompany; track item.search.idRecherche) {
              <tr 
                (click)="goToSearchDetails(item.search.idRecherche)"
              >
                <td class="firstTd">{{ item.company.raisonSociale }}</td>
                <td>{{ item.company.ville }}</td>
                <td>{{ item.search.dateCreation | date:'dd/MM/yyyy' }}</td>
                <td>
                  <span [class]="getStatusClass(item.search.statut)">
                    {{ getStatusLabel(item.search.statut) }}
                  </span>
                </td>
                <td class="lastTd">
                  <!-- Espace réservé pour les futurs boutons de modification et suppression -->
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    </div>
  
    <!-- Vue cards pour mobile -->
    <div class="cards-view">
      @for (item of filteredSearchesWithCompany; track item.search.idRecherche) {
        <div 
          class="search-card"
          (click)="goToSearchDetails(item.search.idRecherche)"
        >
          <div class="card-header">
            <h4>{{ item.company.raisonSociale }}</h4>
            <span [class]="getStatusClass(item.search.statut)">
              {{ getStatusLabel(item.search.statut) }}
            </span>
          </div>
          <div class="card-content">
            <p class="location">
              <span class="label">Ville:</span> 
              {{ item.company.ville }}
            </p>
            <p class="date">
              <span class="label">Date:</span> 
              {{ item.search.dateCreation | date:'dd/MM/yyyy' }}
            </p>
          </div>
        </div>
      }
    </div>
  }
</div>